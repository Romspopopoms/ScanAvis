(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[611],{9211:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/paiement",function(){return __webpack_require__(417)}])},8655:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893);__webpack_require__(7294);let Spinner=()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"spinner-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"spinner"})});__webpack_exports__.Z=Spinner},417:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return paiement}});var jsx_runtime=__webpack_require__(5893),react=__webpack_require__(7294),stripe_esm=__webpack_require__(1291),react_stripe_umd=__webpack_require__(6664),CartContext=__webpack_require__(4426),AuthContext=__webpack_require__(4642);let stripePromise=(0,stripe_esm.J)("pk_test_51OPtGvDWmnYPaxs1gSpLL1WpDyU6gaxOBszqNCSu9iHVeEYuPcjUEvOpKzjwdbF6NUWquoEPf24Y3qMwIDLmeLvl00FwQkUSKx"),cardElementOptions={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},CheckoutFormContent=()=>{let stripe=(0,react_stripe_umd.useStripe)(),elements=(0,react_stripe_umd.useElements)(),{cartItem,clearCart}=(0,CartContext.jD)(),{user}=(0,react.useContext)(AuthContext.Vo),[clientSecret,setClientSecret]=(0,react.useState)(""),[isProcessing,setIsProcessing]=(0,react.useState)(!1),[errorMessage,setErrorMessage]=(0,react.useState)("");(0,react.useEffect)(()=>{let fetchPaymentIntent=async()=>{if(cartItem&&user)try{let response=await fetch("/.netlify/functions/complete-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:cartItem.priceId,userUuid:user.uuid})}),data=await response.json();if(!response.ok)throw Error(data.error||"Server error");setClientSecret(data.clientSecret)}catch(error){console.error("Error fetching payment intent:",error),setErrorMessage(error.message)}};fetchPaymentIntent()},[cartItem,user]);let handleSubmit=async event=>{if(event.preventDefault(),!stripe||!elements){setErrorMessage("Stripe.js has not loaded yet.");return}setIsProcessing(!0),setErrorMessage("");let cardNumberElement=elements.getElement(react_stripe_umd.CardNumberElement),cardExpiryElement=elements.getElement(react_stripe_umd.CardExpiryElement),cardCvcElement=elements.getElement(react_stripe_umd.CardCvcElement);if(!cardNumberElement||!cardExpiryElement||!cardCvcElement){setErrorMessage("Card details cannot be found."),setIsProcessing(!1);return}let{error,paymentIntent}=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardNumberElement,billing_details:{name:user?user.name:"Guest User"}}});error?(setErrorMessage(error.message),setIsProcessing(!1)):"succeeded"===paymentIntent.status&&clearCart(),setIsProcessing(!1)};return(0,jsx_runtime.jsx)("div",{className:"min-h-screen flex justify-center items-center",children:(0,jsx_runtime.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl max-w-md w-full",children:[(0,jsx_runtime.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Subscription Details"}),(0,jsx_runtime.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[errorMessage&&(0,jsx_runtime.jsx)("div",{className:"error-message",children:errorMessage}),(0,jsx_runtime.jsx)(react_stripe_umd.CardNumberElement,{options:cardElementOptions}),(0,jsx_runtime.jsx)(react_stripe_umd.CardExpiryElement,{options:cardElementOptions}),(0,jsx_runtime.jsx)(react_stripe_umd.CardCvcElement,{options:cardElementOptions}),(0,jsx_runtime.jsx)("button",{type:"submit",disabled:!stripe||!clientSecret||isProcessing,className:"w-full bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700",children:isProcessing?"Processing...":"Subscribe"})]})]})})},CheckoutForm=()=>(0,jsx_runtime.jsx)(react_stripe_umd.Elements,{stripe:stripePromise,children:(0,jsx_runtime.jsx)(CheckoutFormContent,{})});var Spinner=__webpack_require__(8655);let paiement_stripePromise=(0,stripe_esm.J)("pk_test_51OPtGvDWmnYPaxs1gSpLL1WpDyU6gaxOBszqNCSu9iHVeEYuPcjUEvOpKzjwdbF6NUWquoEPf24Y3qMwIDLmeLvl00FwQkUSKx"),PagePaiement=()=>{let[loading,setLoading]=(0,react.useState)(!0);return((0,react.useEffect)(()=>{paiement_stripePromise.then(()=>{setLoading(!1)}).catch(error=>{console.error("Erreur lors du chargement de Stripe:",error),setLoading(!1)})},[]),loading)?(0,jsx_runtime.jsx)(Spinner.Z,{}):(0,jsx_runtime.jsx)("div",{className:"relative z-10 min-h-screen",children:(0,jsx_runtime.jsx)(react_stripe_umd.Elements,{stripe:paiement_stripePromise,children:(0,jsx_runtime.jsx)("div",{className:"page-container",children:(0,jsx_runtime.jsx)(CheckoutForm,{})})})})};var paiement=PagePaiement}},function(__webpack_require__){__webpack_require__.O(0,[101,774,888,179],function(){return __webpack_require__(__webpack_require__.s=9211)}),_N_E=__webpack_require__.O()}]);